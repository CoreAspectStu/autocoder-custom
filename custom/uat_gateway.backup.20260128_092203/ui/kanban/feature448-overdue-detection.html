<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature #448: Overdue Detection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .stats-bar {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 6px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-value.overdue {
            color: #dc2626;
        }

        .stat-value.ontime {
            color: #16a34a;
        }

        .stat-value.total {
            color: #2563eb;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #f0f0f0;
        }

        .filter-btn.active {
            border-color: #3b82f6;
            background: #eff6ff;
            color: #3b82f6;
        }

        .filter-btn.overdue-btn.active {
            border-color: #dc2626;
            background: #fef2f2;
            color: #dc2626;
        }

        .results-grid {
            display: grid;
            gap: 15px;
        }

        .result-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #ddd;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .result-card.overdue {
            border-left-color: #dc2626;
            background: linear-gradient(to right, #fef2f2, white);
        }

        .result-card.ontime {
            border-left-color: #16a34a;
        }

        .result-card.upcoming {
            border-left-color: #f59e0b;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .result-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .result-id {
            font-size: 0.85rem;
            color: #888;
        }

        .overdue-badge {
            display: inline-block;
            background: #dc2626;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .upcoming-badge {
            display: inline-block;
            background: #f59e0b;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ontime-badge {
            display: inline-block;
            background: #16a34a;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-meta {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .meta-icon {
            font-size: 1rem;
        }

        .meta-text {
            color: #666;
        }

        .due-date {
            color: #dc2626;
            font-weight: 500;
        }

        .due-date.upcoming {
            color: #f59e0b;
        }

        .due-date.ontime {
            color: #16a34a;
        }

        .status-passed {
            color: #16a34a;
        }

        .status-failed {
            color: #dc2626;
        }

        .error-message {
            margin-top: 10px;
            padding: 10px;
            background: #fef2f2;
            border-left: 3px solid #dc2626;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #991b1b;
        }

        .hidden {
            display: none;
        }

        .acceptance-criteria {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .acceptance-criteria h2 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
        }

        .criteria-list {
            list-style: none;
        }

        .criteria-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #f9f9f9;
            border-radius: 4px;
            border-left: 4px solid #ddd;
        }

        .criteria-item.pass {
            border-left-color: #16a34a;
            background: #f0fdf4;
        }

        .criteria-item strong {
            display: block;
            margin-bottom: 3px;
            color: #333;
        }

        .criteria-item p {
            margin: 0;
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Feature #448: Overdue Detection</h1>
        <p class="subtitle">Verify overdue items are highlighted with visual indicators and filtering</p>

        <!-- Statistics Bar -->
        <div class="stats-bar">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value total" id="total-count">0</div>
                    <div class="stat-label">Total Items</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value overdue" id="overdue-count">0</div>
                    <div class="stat-label">Overdue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value ontime" id="ontime-count">0</div>
                    <div class="stat-label">On Time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="overdue-percentage">0%</div>
                    <div class="stat-label">Overdue Rate</div>
                </div>
            </div>
        </div>

        <!-- Filter Buttons -->
        <div class="filter-buttons">
            <button class="filter-btn active" onclick="filterResults('all')">All Items</button>
            <button class="filter-btn overdue-btn" onclick="filterResults('overdue')">‚ö†Ô∏è Overdue Only</button>
            <button class="filter-btn" onclick="filterResults('upcoming')">üïê Upcoming (24h)</button>
            <button class="filter-btn" onclick="filterResults('ontime')">‚úÖ On Time</button>
        </div>

        <!-- Results Grid -->
        <div class="results-grid" id="results-container">
            <!-- Results will be dynamically inserted here -->
        </div>

        <!-- Acceptance Criteria -->
        <div class="acceptance-criteria">
            <h2>‚úÖ Acceptance Criteria</h2>
            <ul class="criteria-list">
                <li class="criteria-item pass">
                    <strong>AC1: Create item with due date</strong>
                    <p>‚úÖ Test results can be created with due_date field</p>
                </li>
                <li class="criteria-item pass">
                    <strong>AC2: Wait for due date to pass</strong>
                    <p>‚úÖ Items can have due dates in the past (overdue state)</p>
                </li>
                <li class="criteria-item pass">
                    <strong>AC3: Verify item is marked overdue</strong>
                    <p>‚úÖ is_overdue() method correctly identifies overdue items</p>
                </li>
                <li class="criteria-item pass">
                    <strong>AC4: Verify visual indicator appears</strong>
                    <p>‚úÖ Overdue items have red badge and visual highlighting</p>
                </li>
                <li class="criteria-item pass">
                    <strong>AC5: Verify overdue list available</strong>
                    <p>‚úÖ Filter methods available: get_overdue(), get_upcoming(), get_on_time()</p>
                </li>
            </ul>
        </div>
    </div>

    <script>
        // Mock test results data (simulating backend response)
        const testResults = [
            {
                id: "TEST-001",
                name: "Authentication - Password Reset Flow",
                passed: false,
                duration_ms: 2500,
                due_date: new Date(Date.now() - 48 * 60 * 60 * 1000), // 48 hours ago
                timestamp: new Date(Date.now() - 50 * 60 * 60 * 1000),
                error_message: "Password reset link expires after 1 hour (too short)"
            },
            {
                id: "TEST-002",
                name: "Payment - Credit Card Processing",
                passed: false,
                duration_ms: 3200,
                due_date: new Date(Date.now() - 24 * 60 * 60 * 1000), // 24 hours ago
                timestamp: new Date(Date.now() - 26 * 60 * 60 * 1000),
                error_message: "Payment gateway timeout after 30 seconds"
            },
            {
                id: "TEST-003",
                name: "Profile - Avatar Upload Validation",
                passed: false,
                duration_ms: 1800,
                due_date: new Date(Date.now() + 2 * 60 * 60 * 1000), // 2 hours from now
                timestamp: new Date(Date.now() - 1 * 60 * 60 * 1000),
                error_message: "Missing file size validation (users can upload 100MB+ files)"
            },
            {
                id: "TEST-004",
                name: "Dashboard - Load Performance",
                passed: true,
                duration_ms: 900,
                due_date: new Date(Date.now() + 120 * 60 * 60 * 1000), // 120 hours from now
                timestamp: new Date(Date.now() - 30 * 60 * 1000),
                error_message: null
            },
            {
                id: "TEST-005",
                name: "Search - Full Text Query Performance",
                passed: true,
                duration_ms: 1200,
                due_date: new Date(Date.now() + 72 * 60 * 60 * 1000), // 72 hours from now
                timestamp: new Date(Date.now() - 1 * 60 * 60 * 1000),
                error_message: null
            },
            {
                id: "TEST-006",
                name: "API - Rate Limiting Enforcement",
                passed: false,
                duration_ms: 1500,
                due_date: new Date(Date.now() - 6 * 60 * 60 * 1000), // 6 hours ago
                timestamp: new Date(Date.now() - 8 * 60 * 60 * 1000),
                error_message: "Rate limit not enforced on POST /api/login"
            },
            {
                id: "TEST-007",
                name: "Email - Notification Delivery",
                passed: true,
                duration_ms: 2100,
                due_date: new Date(Date.now() + 48 * 60 * 60 * 1000), // 48 hours from now
                timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000),
                error_message: null
            }
        ];

        // Helper functions
        function isOverdue(result) {
            return new Date() > result.due_date;
        }

        function isUpcoming(result, hours = 24) {
            const now = new Date();
            const future = new Date(now.getTime() + hours * 60 * 60 * 1000);
            return !isOverdue(result) && result.due_date >= now && result.due_date <= future;
        }

        function formatRelativeTime(date) {
            const now = new Date();
            const diff = date - now;
            const hours = Math.abs(diff) / (1000 * 60 * 60);

            if (diff < 0) {
                if (hours < 1) return `Due ${Math.round(hours * 60)} minutes ago`;
                if (hours < 24) return `Due ${Math.round(hours)} hours ago`;
                return `Due ${Math.round(hours / 24)} days ago`;
            } else {
                if (hours < 1) return `Due in ${Math.round(hours * 60)} minutes`;
                if (hours < 24) return `Due in ${Math.round(hours)} hours`;
                return `Due in ${Math.round(hours / 24)} days`;
            }
        }

        function formatDuration(ms) {
            return `${ms}ms`;
        }

        function getStatusBadge(result) {
            if (isOverdue(result)) {
                return '<span class="overdue-badge">‚ö†Ô∏è OVERDUE</span>';
            } else if (isUpcoming(result, 24)) {
                return '<span class="upcoming-badge">üïê DUE SOON</span>';
            } else {
                return '<span class="ontime-badge">‚úÖ ON TIME</span>';
            }
        }

        function getStatusClass(result) {
            if (isOverdue(result)) return 'overdue';
            if (isUpcoming(result, 24)) return 'upcoming';
            return 'ontime';
        }

        function renderResult(result) {
            const statusClass = getStatusClass(result);
            const badge = getStatusBadge(result);
            const statusIcon = result.passed ? '‚úÖ' : '‚ùå';
            const statusText = result.passed ? 'PASSED' : 'FAILED';
            const statusClassText = result.passed ? 'status-passed' : 'status-failed';
            const dueDateClass = isOverdue(result) ? 'due-date' : (isUpcoming(result, 24) ? 'due-date upcoming' : 'due-date ontime');

            return `
                <div class="result-card ${statusClass}" data-status="${statusClass}">
                    <div class="result-header">
                        <div>
                            <div class="result-title">${result.name}</div>
                            <div class="result-id">${result.id}</div>
                        </div>
                        ${badge}
                    </div>

                    <div class="result-meta">
                        <div class="meta-item">
                            <span class="meta-icon">${statusIcon}</span>
                            <span class="meta-text ${statusClassText}">${statusText}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-icon">‚è±Ô∏è</span>
                            <span class="meta-text">${formatDuration(result.duration_ms)}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-icon">üìÖ</span>
                            <span class="meta-text ${dueDateClass}">${formatRelativeTime(result.due_date)}</span>
                        </div>
                    </div>

                    ${result.error_message ? `<div class="error-message">${result.error_message}</div>` : ''}
                </div>
            `;
        }

        function updateStats() {
            const total = testResults.length;
            const overdue = testResults.filter(r => isOverdue(r)).length;
            const ontime = total - overdue;
            const percentage = total > 0 ? ((overdue / total) * 100).toFixed(1) : 0;

            document.getElementById('total-count').textContent = total;
            document.getElementById('overdue-count').textContent = overdue;
            document.getElementById('ontime-count').textContent = ontime;
            document.getElementById('overdue-percentage').textContent = `${percentage}%`;
        }

        function filterResults(filter) {
            const container = document.getElementById('results-container');
            const buttons = document.querySelectorAll('.filter-btn');

            // Update active button
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Filter results
            let filteredResults;
            if (filter === 'all') {
                filteredResults = testResults;
            } else if (filter === 'overdue') {
                filteredResults = testResults.filter(r => isOverdue(r));
            } else if (filter === 'upcoming') {
                filteredResults = testResults.filter(r => isUpcoming(r, 24));
            } else if (filter === 'ontime') {
                filteredResults = testResults.filter(r => !isOverdue(r) && !isUpcoming(r, 24));
            }

            // Render filtered results
            container.innerHTML = filteredResults.map(renderResult).join('');

            // Show count
            if (filteredResults.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üì≠</div>
                        <p>No items found for this filter</p>
                    </div>
                `;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateStats();
            filterResults('all'); // Show all results by default
        });
    </script>
</body>
</html>
