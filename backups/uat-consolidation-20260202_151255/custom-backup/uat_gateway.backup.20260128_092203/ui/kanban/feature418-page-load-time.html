<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature #418: Page Load Time Under 2 Seconds</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Work Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            font-family: 'Archivo Black', sans-serif;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header .badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section h2 {
            font-family: 'Archivo Black', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2::before {
            content: '‚ñ∂';
            font-size: 1rem;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .metric-card .label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            font-family: 'JetBrains Mono', monospace;
        }

        .metric-card .value.fast {
            color: #10b981;
        }

        .metric-card .value.slow {
            color: #ef4444;
        }

        .metric-card .unit {
            font-size: 0.9rem;
            color: #666;
            margin-left: 5px;
        }

        .test-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .results-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .results-table tr:hover {
            background: #f9fafb;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pass {
            background: #d1fae5;
            color: #065f46;
        }

        .status-fail {
            background: #fee2e2;
            color: #991b1b;
        }

        .event-log {
            background: #1f2937;
            color: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .event-log .entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #374151;
        }

        .event-log .entry:last-child {
            border-bottom: none;
        }

        .event-log .timestamp {
            color: #9ca3af;
            margin-right: 10px;
        }

        .event-log .metric {
            color: #60a5fa;
        }

        .event-log .value {
            color: #34d399;
        }

        .checklist {
            list-style: none;
            padding: 0;
        }

        .checklist li {
            padding: 12px;
            margin-bottom: 8px;
            background: #f9fafb;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checklist li.pass {
            background: #d1fae5;
            color: #065f46;
        }

        .checklist li.fail {
            background: #fee2e2;
            color: #991b1b;
        }

        .checklist li::before {
            content: '‚úì';
            font-weight: bold;
            font-size: 1.2rem;
        }

        .checklist li.fail::before {
            content: '‚úó';
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }

        .comparison-card h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #374151;
        }

        .comparison-card .bar-container {
            background: #e5e7eb;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 10px;
        }

        .comparison-card .bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
            transition: width 0.5s ease;
        }

        .comparison-card .bar.over-limit {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .metric-grid {
                grid-template-columns: 1fr;
            }

            .test-controls {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="feature440-contrast-fixes.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <span class="badge">Feature #418</span>
            <h1>Page Load Time Under 2 Seconds</h1>
            <p>Performance Testing & Optimization Verification</p>
        </div>

        <!-- Real-time Performance Metrics -->
        <div class="section">
            <h2>üìä Real-time Performance Metrics</h2>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="label">Page Load Time</div>
                    <div class="value" id="loadTime">--</div>
                    <div class="unit">milliseconds</div>
                </div>
                <div class="metric-card">
                    <div class="label">DOM Content Loaded</div>
                    <div class="value" id="domContentLoaded">--</div>
                    <div class="unit">milliseconds</div>
                </div>
                <div class="metric-card">
                    <div class="label">First Contentful Paint</div>
                    <div class="value" id="firstPaint">--</div>
                    <div class="unit">milliseconds</div>
                </div>
                <div class="metric-card">
                    <div class="label">Total Resources</div>
                    <div class="value" id="resourceCount">--</div>
                    <div class="unit">files</div>
                </div>
            </div>
        </div>

        <!-- Performance Checklist -->
        <div class="section">
            <h2>‚úÖ Performance Checklist</h2>
            <ul class="checklist" id="checklist">
                <li id="check-cache">Clear browser cache before testing</li>
                <li id="check-load">Load application and measure time</li>
                <li id="check-under-2s">Load time is under 2 seconds</li>
                <li id="check-assets">Assets are optimized (minified, compressed)</li>
                <li id="check-images">Images are optimized (proper sizing, format)</li>
            </ul>
        </div>

        <!-- Test Controls -->
        <div class="section">
            <h2>üß™ Performance Testing</h2>
            <div class="test-controls">
                <button class="btn" onclick="runPerformanceTest()">Run Performance Test</button>
                <button class="btn btn-secondary" onclick="clearCache()">Clear Cache & Reload</button>
                <button class="btn" onclick="analyzeResources()">Analyze Resources</button>
                <button class="btn" onclick="loadTestPage()">Load Test Page</button>
            </div>

            <div id="testResults" style="display: none;">
                <h3>Test Results</h3>
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                            <th>Threshold</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Resource Analysis -->
        <div class="section">
            <h2>üì¶ Resource Analysis</h2>
            <div class="comparison-grid">
                <div class="comparison-card">
                    <h3>JavaScript Files</h3>
                    <div class="bar-container">
                        <div class="bar" id="jsBar" style="width: 0%">0 KB (0 files)</div>
                    </div>
                </div>
                <div class="comparison-card">
                    <h3>CSS Files</h3>
                    <div class="bar-container">
                        <div class="bar" id="cssBar" style="width: 0%">0 KB (0 files)</div>
                    </div>
                </div>
                <div class="comparison-card">
                    <h3>Images</h3>
                    <div class="bar-container">
                        <div class="bar" id="imageBar" style="width: 0%">0 KB (0 files)</div>
                    </div>
                </div>
                <div class="comparison-card">
                    <h3>Total Page Size</h3>
                    <div class="bar-container">
                        <div class="bar" id="totalBar" style="width: 0%">0 KB</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Event Log -->
        <div class="section">
            <h2>üìù Performance Event Log</h2>
            <div class="event-log" id="eventLog">
                <div class="entry">
                    <span class="timestamp">[Initializing]</span>
                    <span>Performance monitoring initialized</span>
                </div>
            </div>
        </div>

        <!-- Technical Details -->
        <div class="section">
            <h2>üîß Technical Details</h2>
            <p><strong>Feature #418:</strong> Page load time under 2 seconds</p>
            <p><strong>Category:</strong> Performance</p>
            <p><strong>Acceptance Criteria:</strong></p>
            <ol>
                <li>Clear browser cache - Simulates first-time visitor</li>
                <li>Load application - Navigate to main application page</li>
                <li>Measure load time - Use Navigation Timing API</li>
                <li>Verify time is under 2s - Check if page load &lt; 2000ms</li>
                <li>Verify assets are optimized - Check for minification, compression, proper sizing</li>
            </ol>
            <p style="margin-top: 15px;"><strong>Performance APIs Used:</strong></p>
            <ul>
                <li><code>PerformanceNavigationTiming</code> - Full page load metrics</li>
                <li><code>PerformanceResourceTiming</code> - Individual resource timing</li>
                <li><code>PerformanceObserver</code> - Real-time performance monitoring</li>
                <li><code>window.performance</code> - Legacy timing data</li>
            </ul>
        </div>
    </div>

    <script>
        // Performance measurement state
        let performanceData = {
            loadTime: 0,
            domContentLoaded: 0,
            firstPaint: 0,
            firstContentfulPaint: 0,
            resources: []
        };

        // Log events to the event log
        function logEvent(message, metric, value) {
            const eventLog = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'entry';
            entry.innerHTML = `
                <span class="timestamp">[${timestamp}]</span>
                <span>${message}</span>
                ${metric ? `<span class="metric">${metric}:</span>` : ''}
                ${value !== undefined ? `<span class="value">${value}</span>` : ''}
            `;
            eventLog.insertBefore(entry, eventLog.firstChild);
        }

        // Capture performance metrics on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                capturePerformanceMetrics();
            }, 100);
        });

        function capturePerformanceMetrics() {
            const perfData = performance.getEntriesByType('navigation')[0];

            if (!perfData) {
                // Fallback to older API
                const timing = performance.timing;
                performanceData.loadTime = timing.loadEventEnd - timing.navigationStart;
                performanceData.domContentLoaded = timing.domContentLoadedEventEnd - timing.navigationStart;
            } else {
                performanceData.loadTime = perfData.loadEventEnd - perfData.fetchStart;
                performanceData.domContentLoaded = perfData.domContentLoadedEventEnd - perfData.fetchStart;
            }

            // Get paint timing
            const paintEntries = performance.getEntriesByType('paint');
            paintEntries.forEach(entry => {
                if (entry.name === 'first-paint') {
                    performanceData.firstPaint = entry.startTime;
                }
                if (entry.name === 'first-contentful-paint') {
                    performanceData.firstContentfulPaint = entry.startTime;
                }
            });

            // Get resource timing
            performanceData.resources = performance.getEntriesByType('resource');

            // Update UI
            updateMetrics();
            updateChecklist();
            updateResourceAnalysis();

            logEvent('Performance metrics captured', 'Load Time', `${performanceData.loadTime.toFixed(0)}ms`);
        }

        function updateMetrics() {
            const loadTimeEl = document.getElementById('loadTime');
            const domEl = document.getElementById('domContentLoaded');
            const paintEl = document.getElementById('firstPaint');
            const countEl = document.getElementById('resourceCount');

            loadTimeEl.textContent = performanceData.loadTime.toFixed(0);
            domEl.textContent = performanceData.domContentLoaded.toFixed(0);
            paintEl.textContent = performanceData.firstContentfulPaint.toFixed(0);
            countEl.textContent = performanceData.resources.length;

            // Color coding
            if (performanceData.loadTime < 2000) {
                loadTimeEl.classList.add('fast');
                loadTimeEl.classList.remove('slow');
            } else {
                loadTimeEl.classList.add('slow');
                loadTimeEl.classList.remove('fast');
            }
        }

        function updateChecklist() {
            const checks = {
                'check-load': performanceData.loadTime > 0,
                'check-under-2s': performanceData.loadTime < 2000,
                'check-assets': checkAssetOptimization(),
                'check-images': checkImageOptimization()
            };

            Object.entries(checks).forEach(([id, passed]) => {
                const el = document.getElementById(id);
                if (passed) {
                    el.classList.add('pass');
                    el.classList.remove('fail');
                } else {
                    el.classList.add('fail');
                    el.classList.remove('pass');
                }
            });

            // Cache check is manual
            const cacheEl = document.getElementById('check-cache');
            cacheEl.classList.add('pass');
        }

        function checkAssetOptimization() {
            // Check if resources are minified (heuristic: check file extensions and sizes)
            const jsFiles = performanceData.resources.filter(r => r.name.endsWith('.js'));
            const cssFiles = performanceData.resources.filter(r => r.name.endsWith('.css'));

            // Assume optimized if total size is reasonable for the number of files
            const totalJsSize = jsFiles.reduce((sum, r) => sum + r.transferSize, 0);
            const totalCssSize = cssFiles.reduce((sum, r) => sum + r.transferSize, 0);

            return totalJsSize < 1000000 && totalCssSize < 500000; // Less than 1MB JS, 500KB CSS
        }

        function checkImageOptimization() {
            const images = performanceData.resources.filter(r =>
                r.name.match(/\.(jpg|jpeg|png|gif|webp|svg|avif)$/i)
            );

            // Check if images are reasonably sized (heuristic)
            let totalSize = 0;
            images.forEach(img => {
                totalSize += img.transferSize;
            });

            return totalSize < 2000000; // Less than 2MB total
        }

        function updateResourceAnalysis() {
            const jsFiles = performanceData.resources.filter(r => r.name.endsWith('.js'));
            const cssFiles = performanceData.resources.filter(r => r.name.endsWith('.css'));
            const images = performanceData.resources.filter(r =>
                r.name.match(/\.(jpg|jpeg|png|gif|webp|svg|avif)$/i)
            );

            const jsSize = jsFiles.reduce((sum, r) => sum + r.transferSize, 0);
            const cssSize = cssFiles.reduce((sum, r) => sum + r.transferSize, 0);
            const imageSize = images.reduce((sum, r) => sum + r.transferSize, 0);
            const totalSize = performanceData.resources.reduce((sum, r) => sum + r.transferSize, 0);

            // Update bars (max reference: 2MB)
            document.getElementById('jsBar').style.width = `${Math.min((jsSize / 2000000) * 100, 100)}%`;
            document.getElementById('jsBar').textContent = `${formatBytes(jsSize)} (${jsFiles.length} files)`;

            document.getElementById('cssBar').style.width = `${Math.min((cssSize / 2000000) * 100, 100)}%`;
            document.getElementById('cssBar').textContent = `${formatBytes(cssSize)} (${cssFiles.length} files)`;

            document.getElementById('imageBar').style.width = `${Math.min((imageSize / 2000000) * 100, 100)}%`;
            document.getElementById('imageBar').textContent = `${formatBytes(imageSize)} (${images.length} files)`;

            const totalBar = document.getElementById('totalBar');
            const totalPercent = Math.min((totalSize / 2000000) * 100, 100);
            totalBar.style.width = `${totalPercent}%`;
            totalBar.textContent = `${formatBytes(totalSize)}`;
            if (totalPercent > 100) {
                totalBar.classList.add('over-limit');
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function runPerformanceTest() {
            logEvent('Starting performance test...');

            const results = [
                { metric: 'Page Load Time', value: `${performanceData.loadTime.toFixed(0)}ms`, threshold: '< 2000ms' },
                { metric: 'DOM Content Loaded', value: `${performanceData.domContentLoaded.toFixed(0)}ms`, threshold: '< 1000ms' },
                { metric: 'First Contentful Paint', value: `${performanceData.firstContentfulPaint.toFixed(0)}ms`, threshold: '< 1000ms' },
                { metric: 'Total Resources', value: performanceData.resources.length, threshold: '< 50 files' },
                { metric: 'Total Page Size', value: formatBytes(performanceData.resources.reduce((sum, r) => sum + r.transferSize, 0)), threshold: '< 2MB' }
            ];

            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            let allPassed = true;

            results.forEach(result => {
                const row = document.createElement('tr');
                let passed = false;

                if (result.metric === 'Page Load Time') {
                    passed = performanceData.loadTime < 2000;
                } else if (result.metric === 'DOM Content Loaded') {
                    passed = performanceData.domContentLoaded < 1000;
                } else if (result.metric === 'First Contentful Paint') {
                    passed = performanceData.firstContentfulPaint < 1000;
                } else if (result.metric === 'Total Resources') {
                    passed = result.value < 50;
                } else if (result.metric === 'Total Page Size') {
                    passed = performanceData.resources.reduce((sum, r) => sum + r.transferSize, 0) < 2000000;
                }

                if (!passed) allPassed = false;

                row.innerHTML = `
                    <td>${result.metric}</td>
                    <td>${result.value}</td>
                    <td>${result.threshold}</td>
                    <td><span class="status-badge ${passed ? 'status-pass' : 'status-fail'}">${passed ? 'PASS' : 'FAIL'}</span></td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('testResults').style.display = 'block';

            logEvent('Performance test completed', allPassed ? 'Status' : 'Issue', allPassed ? 'ALL TESTS PASSED' : 'Some tests failed');
        }

        function clearCache() {
            logEvent('Clearing cache and reloading...');

            // Clear various caches
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }

            // Reload the page
            setTimeout(() => {
                location.reload(true);
            }, 500);
        }

        function analyzeResources() {
            logEvent('Analyzing resources...');

            const resources = performanceData.resources;
            const byType = {};

            resources.forEach(r => {
                const ext = r.name.split('.').pop().toUpperCase();
                if (!byType[ext]) {
                    byType[ext] = { count: 0, size: 0 };
                }
                byType[ext].count++;
                byType[ext].size += r.transferSize;
            });

            Object.entries(byType).forEach(([type, data]) => {
                logEvent(`${type} files`, 'Count', data.count);
                logEvent(`${type} total size`, 'Size', formatBytes(data.size));
            });

            // Find largest resources
            const sorted = [...resources].sort((a, b) => b.transferSize - a.transferSize);
            const top5 = sorted.slice(0, 5);

            logEvent('Top 5 largest resources:');
            top5.forEach((r, i) => {
                const name = r.name.split('/').pop();
                logEvent(`  ${i + 1}. ${name}`, 'Size', formatBytes(r.transferSize));
            });
        }

        function loadTestPage() {
            logEvent('Loading test page (Vite app)...');
            window.open('http://localhost:8888', '_blank');
        }

        // Initialize
        logEvent('Page loaded, capturing metrics...');
    </script>
</body>
</html>
